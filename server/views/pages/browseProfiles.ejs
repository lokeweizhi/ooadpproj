<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>
        <%= title %>
    </title>
    <% include ../partials/stylesheet %>
    <% include ../partials/javascript %>
    <link rel='stylesheet prefetch' href='https://use.fontawesome.com/releases/v5.0.8/css/all.css'>
    <link rel='stylesheet prefetch' href='http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css'>
    <link href="/stylesheets/profile.css" rel='stylesheet' type='text/css' />
</head>

<body>
    <% include ../partials/header2 %>
    <div class="login-main">
        <div class="container">
        <!-- <div class="wrap"> -->
            <!-- <h1><%=webTitle%></h1> -->
            <header class="headerImage">
            </header>
            <main>
                <div class="row">
                <div class="left col-lg-4">
                    <div class="photo-left">
                    <img class="photo" src="../images/profileImages/<%= item.imageName %>"/>
                    </div>
                    <h4 class="name" id="username" name="username" style="color: #777;"><span id="verified"></span><%=item.username %></h4>
                    <!-- <p class="info"><%=user.id %></p> -->
                    <p class="info"><%=item.location %></p>
                    <div class="stats row">
                    <div class="stat col-xs-4" style="padding-right: 50px;">
                        <p class="number-stat"></p>
                        <p class="desc-stat"></p>
                    </div>
                    <div class="stat col-xs-4">
                        <p class="number-stat">2</p>
                        <p class="desc-stat">Listings</p>
                    </div>
                    <div class="stat col-xs-4" style="padding-left: 50px;">
                        <p class="number-stat"></p>
                        <p class="desc-stat"></p>
                    </div>
                    </div>
                    <p class="desc"><%=item.aboutMe %></p>
                    <div class="social">
                        <div class="average">
                            <div class="stars-outer">
                            <div class="stars-inner"></div>
                            </div>
                            <span id="averageRating"></span>
                            <span class="number-rating"></span>
                        </div>
                    </div>
                    <br>
                </div>
                <!--DELETE IF FAILS-->
                <div class="right col-lg-8">
                    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="pills-home-tab" data-toggle="pill" href="#pills-home" role="tab" aria-controls="pills-home" aria-selected="true">Listings</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#pills-profile" role="tab" aria-controls="pills-profile" aria-selected="false">Reviews</a>
                        </li>
                        
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab">
                            <!--Listings-->
                            <div class="row gallery">
                                <% for(var i=0; i < itemList.length; i++){ %>
                                <div class="col-md-4" data-id="<%= itemList[i].id %>">
                                    <p>Name: <strong><%= itemList[i].name %></strong></p>
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774813-photo4.jpg"/>
                                    <p>Price: <strong><%= itemList[i].group %></strong></p>
                                    <p>Condition: <strong><%= itemList[i].hobby %></strong></p>
                                </div>
                                <% } %>    
                                <!-- <div class="col-md-4">
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774813-photo4.jpg"/>
                                </div>
                                <div class="col-md-4">
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774814-photo5.jpg"/>
                                </div>
                                <div class="col-md-4">
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774814-photo6.jpg"/>
                                </div>
                                <div class="col-md-4">
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774817-photo1.jpg"/>
                                </div>
                                <div class="col-md-4">
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774815-photo2.jpg"/>
                                </div>
                                <div class="col-md-4">
                                    <img src="https://image.noelshack.com/fichiers/2017/38/2/1505774816-photo3.jpg"/>
                                </div> -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab">
                            <!--Reviews-->
                            <div class="form-row">
                                <!-- <div class="form-group col-md-4"> -->
                                    <div class="lead">
                                        <div class="list-group">
                                            <center><h3 style="font-size: 0.875em;font-weight: 700;font-size: 1em;padding-bottom: 0.5em;text-decoration: underline;">Reviews</h3></center>
                                            <% profile.forEach(function(review){ %>
                                                <a href="#" class="list-group-item" data-id="<%= review.id%>">
                                                    <div class="reviews">
                                                        <form action="/profile" method="delete">
                                                            <h4 style="font-size: 0.875em;font-weight: 700;font-size: 1em;padding-bottom: 0.5em;text-decoration: underline;">
                                                                <%= review.title %>
                                                                <button class="btn btn-danger pull-right deleteBtn" type="button" data-id="<%= review.id%>">Delete</button>
                                                            </h4>
                                                            <p class="list-group-item-text">
                                                                <%= review.content %>
                                                            </p>
                                                            <p class="list-group-item-text" id="usersRating">
                                                                <%= review.rating %> / 5
                                                            </p>
                                                            <small class="text-muted">By:
                                                                @<span class="by" ><%= review.by %></span>
                                                            </small>
                                                            <!-- <small class="text-muted">
                                                                (@<span class="id" ><%= review.user_id %></span>)
                                                            </small> -->
                                                            <!-- <small class="text-muted">
                                                                (<%= review.created %>) (<%= review.buyerOrSeller %>)
                                                            </small> -->
                                                            <!--<small><%= review.targetUsername %></small>--> <!--To be deleted, used for testing purposes-->
                                                        </form>
                                                    </div>
                                                </a>
                                                <% }); %> 
                                        </div>
                                    </div>
                                <!-- </div> -->
                            </div>
                            <!--//Reviews-->
                        </div>
                    </div>
                </div>
                <!--//FAILS-->
            </main>
        <!-- </div> -->
        </div>
    </div>  
     
        <% include ../partials/footer %>
        <script>
        // redirects to the next user
        $('.by').click(function () {
            var username = $(this).closest('.list-group-item').find('.by').text();
            location.href = "<%-urlPath%>/"+username;
        });
        </script>
        
        <script> 
        // calculate the total ratings
        function calculateTotalRatings() {
            var total = 0;
            var avg = 0;
            var usersRating = document.querySelectorAll("#usersRating");
            for (var i=0; i<usersRating.length; i++) {
                value = parseInt(document.querySelectorAll("#usersRating")[i].innerHTML);
                total += value; 
            }
            if (usersRating.length === 0) {
                avg = 0
            }
            else {
                avg = (total / usersRating.length).toFixed(1);
                document.getElementById("averageRating").innerHTML = avg;
            }
        }
        calculateTotalRatings();        
        </script>
        <script src="/javascripts/profile.js"></script>   
</body>

</html>